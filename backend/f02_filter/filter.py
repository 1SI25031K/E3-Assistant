import json

# ==========================================
# 1. ãƒ¦ã‚¦ãƒªã•ã‚“(F-01)ã‹ã‚‰æ¥ã‚‹ã¯ãšã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
# ï¼ˆæœ¬æ¥ã¯ã“ã“ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çµŒç”±ã§é€ã‚‰ã‚Œã¦ãã¾ã™ãŒã€ä»Šã¯æ‰‹æ›¸ãã§ç”¨æ„ã—ã¾ã™ï¼‰
# ==========================================
mock_input_data = {
    "source": "slack",
    "event_id": "evt_123456789",
    "user_id": "U12345",
    "text_content": "æ¥é€±ã®ã‚·ãƒ•ãƒˆã«ã¤ã„ã¦è³ªå•ãŒã‚ã‚Šã¾ã™",  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿å†…å®¹
    "timestamp": "2023-12-05T10:00:00Z"
}

# ==========================================
# 2. ã‚³ã‚¦ã‚¿ã•ã‚“(F-02)ã®ä»•äº‹: æ„å›³åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
# ==========================================
def determine_intent(text):
    """
    ãƒ†ã‚­ã‚¹ãƒˆã®å†…å®¹ã‚’è¦‹ã¦ã€intent_tag ã‚’æ±ºå®šã™ã‚‹å˜ç´”ãªãƒ­ã‚¸ãƒƒã‚¯
    """
    # ã€Œï¼Ÿã€ã‚„ã€Œè³ªå•ã€ã¨ã„ã†è¨€è‘‰ãŒã‚ã‚Œã° "question" (è³ªå•) ã¨ã¿ãªã™
    if "?" in text or "è³ªå•" in text:
        return "question"
    # ãã‚Œä»¥å¤–ã¯ "chat" (é›‘è«‡) ã¨ã™ã‚‹
    else:
        return "chat"

# ==========================================
# 3. ãƒ¡ã‚¤ãƒ³å‡¦ç†: ãƒ‡ãƒ¼ã‚¿ã®åŠ å·¥ã¨ç¢ºèª
# ==========================================
def main():
    print("--- ğŸ“¥ [F-01] ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ä¿¡ã—ã¾ã—ãŸ ---")
    print(json.dumps(mock_input_data, indent=2, ensure_ascii=False))

    # ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦æ–°ã—ã„ç®±ã‚’ç”¨æ„ï¼ˆå…ƒã®ãƒ‡ãƒ¼ã‚¿ã‚’å£Šã•ãªã„ãŸã‚ï¼‰
    processed_data = mock_input_data.copy()

    # æ„å›³åˆ¤å®šã‚’å®Ÿè¡Œã—ã¦ã‚¿ã‚°ä»˜ã‘
    tag = determine_intent(processed_data["text_content"])
    processed_data["intent_tag"] = tag

    # â˜…ã“ã“ãŒé‡è¦: READMEã®ä»•æ§˜é€šã‚Šã«ãƒ‡ãƒ¼ã‚¿ãŒè‚²ã£ã¦ã„ã‚‹ã‹ç¢ºèª
    print("\n--- âš™ï¸ [F-02] æ„å›³åˆ¤å®šã‚’å®Ÿè¡Œä¸­... ---")
    print(f"åˆ¤å®šçµæœ: {tag}")

    print("\n--- ğŸ“¤ [F-03] ã¸æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ (å®Œæˆå½¢) ---")
    print(json.dumps(processed_data, indent=2, ensure_ascii=False))

    # ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã®æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
    required_keys = ["source", "user_id", "text_content", "intent_tag"]
    missing_keys = [key for key in required_keys if key not in processed_data]
    
    if not missing_keys:
        print("\nâœ… OK: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã¯READMEã®ä»•æ§˜ã¨ä¸€è‡´ã—ã¦ã„ã¾ã™ã€‚")
    else:
        print(f"\nâŒ NG: ä»¥ä¸‹ã®ã‚­ãƒ¼ãŒè¶³ã‚Šã¾ã›ã‚“ -> {missing_keys}")

        # â˜…â˜…â˜… ã“ã“ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼ â˜…â˜…â˜…
    # ãƒ‡ãƒ¼ã‚¿ã‚’JSONå½¢å¼ã®æ–‡å­—ã«ã—ã¦ã€å‘¼ã³å‡ºã—å…ƒã«ã€Œè¿”ã™ã€
    return json.dumps(processed_data, ensure_ascii=False)

if __name__ == "__main__":
    main()